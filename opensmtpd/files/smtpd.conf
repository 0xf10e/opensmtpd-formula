{#  based on example configuration from 
    https://www.opensmtpd.org/smtpd.conf.5.html -#}
{% from 'opensmtpd/defaults.jinja' import defaults -%}
{% from 'opensmtpd/map.jinja' import opensmtpd -%}
listen on lo0
#table aliases db:/etc/mail/aliases.db
#table secrets db:/etc/mail/secrets.db
{% for table, details in salt['pillar.get'](
        'opensmtpd:tables', defaults.tables).items() -%}
    {% if 'type' in details and details.type != 'inline' %}
table {{ table }} {{details.type}}:{%
        if details.path.startswith('/') -%}
            {{ details.path }}
        {% else -%}
            {{ opensmtpd.configdir }}/{{ details.path }}
        {% endif -%}
    {% else -%}
table {{ table }} { \{%
        if details.entries is mapping %}
            {%- for key, value in details.entries.items() %}
    {{ key }} = {{ value }}{%
                if not loop.last %},{% endif %} \
            {%- endfor -%}
         {% elif details.entries is sequence -%}
            {% for value in details.entries %}
    {{ value }}{%
                if not loop.last %},{% endif %} \
            {%- endfor -%}
        {% endif %}
}
    {%- endif %}
{%- endfor %}
accept for local alias <aliases> deliver to mbox
accept for any relay via tls+auth://label@smtp.example.com \
    auth <secrets>
